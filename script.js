require=function t(e,s,a){function i(o,h){if(!s[o]){if(!e[o]){var r="function"==typeof require&&require;if(!h&&r)return r(o,!0);if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=s[o]={exports:{}};e[o][0].call(l.exports,(function(t){return i(e[o][1][t]||t)}),l,l.exports,t,e,s,a)}return s[o].exports}for(var n="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({"tachikomas/AnonGift":[function(t,e,s){const a=t("./Common");e.exports=class extends a{constructor(t){super(t)}}},{"./Common":"tachikomas/Common"}],"tachikomas/Ban":[function(t,e,s){const a=t("./Common");e.exports=class extends a{constructor(t){super(t)}}},{"./Common":"tachikomas/Common"}],"tachikomas/ChartRoot":[function(t,e,s){(function(s){(function(){const a=t("../../../helpers/signals").signals,i=t("../../shared/chartFilter"),n=t("../../../singletons/twitchClient"),o=t("../../../helpers/utils"),h=t("../../../helpers/constants"),r=t("material-color-hash").default,_="undefined"!=typeof window?window._:void 0!==s?s._:null;e.exports=class{constructor(t){this._enabled=!1,this._chartDomSelector=t.chartDomSelector,this._title=t.title,this._helpContent=t.helpContent,this._type=t.type||"doughnut",this.update=_.throttle(()=>{this._update(),this._updateChartObject()},t.updateThrottleTime||1e3),a.add(t.signalListener||(t=>{switch(t.event){case"channel.input.update":this.reset();break;case"stream.load.ready":this.enable(),this.reset();break;case"stream.cleanup":this.disable();break;case"data.cache.updated":case"filter.change":this._enabled&&this.update()}})),this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1}async _update(){}reset(){}_getParameters(){const t=i.getStartTime().unix(),e=i.getEndTime().unix();let s=i.getIntervalLevel(),a=o.getTimeBucket(t,s),r=o.getTimeBucket(e,s),c=Math.floor((r-a)/s)+1;for(;s!=h.BUCKET_DAY&&c>=250;){const t=h.INTERVAL_BUCKETS.indexOf(s);s=h.INTERVAL_BUCKETS[t+1],c=Math.floor((r-a)/s)+1}return i.setIntervalLevel(s),a=o.getTimeBucket(t,s),r=o.getTimeBucket(e,s),{interval:s,startBucket:a,endBucket:r,channel:n.getChannel(),filter:i.getFilter(),length:c}}_getBackgroundColor(){return this._labels.map(t=>r(t,"200").backgroundColor+"4D")}_getBorderColor(){return this._labels.map(t=>r(t,"200").backgroundColor+"FF")}_updateChartObject(){if(this._chartObject)return this._chartObject.data.datasets[0].data=this._datasets,Object.isFrozen(this._chartObject.data.labels)||(this._chartObject.data.labels=this._labels,this._chartObject.data.datasets[0].backgroundColor=this._getBackgroundColor(),this._chartObject.data.datasets[0].borderColor=this._getBorderColor()),void this._chartObject.update();let t;document.getElementById(this._chartDomSelector).innerHTML=templates["./hbs/stream/components/chart.hbs"](this),this._helpDom=new BSN.Popover(document.getElementById(this._chartDomSelector+"-help"),{title:this._title,content:this._helpContent,placement:"left"}),"horizontalBar"===this._type&&(this._type="bar",t="y"),this._chartObject=new Chart(document.getElementById("canvas-"+this._chartDomSelector),{type:this._type,data:{labels:this._labels,datasets:[{data:this._datasets,backgroundColor:this._getBackgroundColor(),borderColor:this._getBorderColor(),borderWidth:1,indexAxis:t}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:this._title,fontSize:18},tooltip:{callbacks:{afterLabel:t=>this.afterLabel?this.afterLabel(t.label):void 0}}}}})}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../helpers/constants":"tachikomas/constants","../../../helpers/signals":"tachikomas/signals","../../../helpers/utils":"tachikomas/utils","../../../singletons/twitchClient":"tachikomas/twitchClient","../../shared/chartFilter":"tachikomas/chartFilter","material-color-hash":void 0}],"tachikomas/Chatters":[function(t,e,s){const a=t("../../shared/chartFilter"),i=templates["./hbs/stream/components/chatters-group.hbs"],n=templates["./hbs/stream/components/chatters-group-list.hbs"];e.exports=class{constructor(t,e){this._initialize(t,e),this.toPreviousPage=_.throttle(this._toPreviousPage.bind(this),200),this.toNextPage=_.throttle(this._toNextPage.bind(this),200),this.updateChattersList=_.throttle(this._updateChattersList.bind(this),2e3)}_initialize(t,e){const s=a.getFilter();this.allChatters=s?e.filter(t=>s(t._userName)):e,this._validatePageNumber(),this._key=t,this._expandButton||(this._chatterContainerDom=document.getElementById("chatter-container").insertAdjacentHTML("beforeend",i(this._key)),this._expandButton=new BSN.Collapse(document.getElementById(this._key+"-expand"))),this.allChatters.length<=250?document.getElementById(this._key+"-paginator").classList.add("d-none"):(document.getElementById(this._key+"-paginator").classList.remove("d-none"),this._updatePaginationNumbers()),document.getElementById(this._key+"-count").textContent=this.allChatters.length,this._updateChattersList()}_validatePageNumber(){const t=Math.max(this._pageNumber||0,0);this._pageNumber=250*t>this.allChatters.length?0:t}_updatePaginationNumbers(){this.allChatters.length>250&&(document.getElementById(this._key+"-pagination-numbers").textContent=`${this.getLeftIndex()} ~ ${this.getRightIndex()}`)}_updateChattersList(){document.getElementById(this._key+"-list-chatters").innerHTML=n(this._getPage())}update(t){this._initialize(this._key,t)}getLeftIndex(){return 250*this._pageNumber}getRightIndex(){return Math.min(this.allChatters.length,this.getLeftIndex()+250)}_getPage(){return this.allChatters.slice(this.getLeftIndex(),this.getRightIndex())}_toNextPage(){250*(this._pageNumber+1)<this.allChatters.length&&(this._pageNumber++,this._updatePaginationNumbers(),this._updateChattersList())}_toPreviousPage(){this._pageNumber-1>=0&&(this._pageNumber--,this._updatePaginationNumbers(),this._updateChattersList())}}},{"../../shared/chartFilter":"tachikomas/chartFilter"}],"tachikomas/Chat":[function(t,e,s){const a=t("./Common");e.exports=class extends a{constructor(t){super(t)}}},{"./Common":"tachikomas/Common"}],"tachikomas/Cheer":[function(t,e,s){const a=t("./Common");e.exports=class extends a{constructor(t){super(t),this.bits=parseInt(t.bits||0)}}},{"./Common":"tachikomas/Common"}],"tachikomas/Common":[function(t,e,s){e.exports=class{constructor(t){this.userID=parseInt(t["user-id"]||t.userID),this.displayName=t["display-name"]||t.displayName,this.timestamp=parseInt(t["tmi-sent-ts"])||t.timestamp}getDisplayName(){return this.displayName}}},{}],"tachikomas/DataBucket":[function(t,e,s){const a=t("../../../helpers/constants"),i=t("./DataNode"),n=t("../../../helpers/utils");class o{constructor(t,e){t?(this[a.TYPE_CHAT]=t[a.TYPE_CHAT].getCopy(e),this[a.TYPE_RESUB]=t[a.TYPE_RESUB].getCopy(e),this[a.TYPE_CHEER]=t[a.TYPE_CHEER].getCopy(e),this[a.TYPE_SUB]=t[a.TYPE_SUB].getCopy(e),this[a.TYPE_BAN]=t[a.TYPE_BAN].getCopy(e),this[a.TYPE_ANONGIFT]=t[a.TYPE_ANONGIFT].getCopy(e),this[a.TYPE_SUBGIFT]=t[a.TYPE_SUBGIFT].getCopy(e),this[a.TYPE_SUBMYSTERY]=t[a.TYPE_SUBMYSTERY].getCopy(e)):(this[a.TYPE_CHAT]=new i,this[a.TYPE_RESUB]=new i,this[a.TYPE_CHEER]=new i,this[a.TYPE_SUB]=new i,this[a.TYPE_BAN]=new i,this[a.TYPE_ANONGIFT]=new i,this[a.TYPE_SUBGIFT]=new i,this[a.TYPE_SUBMYSTERY]=new i)}add(t){this[n.getMessageType(t)].add(t)}getCopy(t){return new o(this,t)}merge(t){return Object.keys(t).forEach(e=>{this[e].merge(t[e])}),this}split(t){Object.keys(t).forEach(e=>{this[e]&&this[e].split(t[e])})}}e.exports=o},{"../../../helpers/constants":"tachikomas/constants","../../../helpers/utils":"tachikomas/utils","./DataNode":"tachikomas/DataNode"}],"tachikomas/DataChannel":[function(t,e,s){const a=t("../../../helpers/constants"),i=t("../../../helpers/utils"),n=t("./DataBucket"),o=t("./DataNode"),h=t("./blanks");e.exports=class{constructor(){this._cachedInterval=void 0,this._cachedFilter=void 0,this._cache={},this._cacheTotalByHour={},this._data={},this._updated=new Set}add(t){const e=Math.floor(t.timestamp/1e3),s=i.getTimeBucket(e,a.BUCKET_MIN);this._updated.add(s),this._data[s]||(this._data[s]=new n),this._data[s].add(t)}_getAt(t,e){const s=this._data[t];return s?s.getCopy(e):h.blankDataBucket}_getAnInterval(t,e,s){let i=this._getAt(t,s);for(let n=t+a.BUCKET_MIN;n<t+e;n+=a.BUCKET_MIN)i=i.merge(this._getAt(n,s));return Object.freeze(i)}_validateCache(t,e){this._cachedInterval===t&&this._cachedFilter===e?this._updated.forEach(e=>{const s=i.getTimeBucket(e,t);delete this._cache[s],delete this._cacheTotalByHour[i.getTimeBucket(s,a.BUCKET_HOUR)]}):(this._cacheTotalByHour={},this._cache={}),this._updated.clear(),this._cachedFilter=e,this._cachedInterval=t}get(t,e,s){return this._validateCache(e,s),this._cache[t]||(this._cache[t]=this._getAnInterval(t,e,s)),this._cache[t]}getTotal(t,e,s,i){this._validateCache(this._cachedInterval||a.BUCKET_MIN,i);let n,r=new o;for(let c=t;c<=e;c+=a.BUCKET_MIN){if(c%a.BUCKET_HOUR==0){if(this._cacheTotalByHour[c]&&this._cacheTotalByHour[c][s]&&0!=this._cacheTotalByHour[c][s]._sum){r=r.merge(this._cacheTotalByHour[c][s]),c+=a.BUCKET_HOUR-a.BUCKET_MIN;continue}if(n){const t=c-a.BUCKET_HOUR;this._cacheTotalByHour[t]||(this._cacheTotalByHour[t]=h.blankDataBucket.getCopy()),this._cacheTotalByHour[t][s]=n}n=new o}const t=this._getAt(c,i)[s];r=r.merge(t),n&&(n=n.merge(t))}return r}}},{"../../../helpers/constants":"tachikomas/constants","../../../helpers/utils":"tachikomas/utils","./DataBucket":"tachikomas/DataBucket","./DataNode":"tachikomas/DataNode","./blanks":"tachikomas/blanks"}],"tachikomas/DataNode":[function(t,e,s){class a{constructor(t,e){this._sum=t||0,this._users=e||{}}add(t){const e=t.bits?t.bits/100:1;this._sum+=e,this._users[t.displayName]=(this._users[t.displayName]||0)+e}getCopy(t){if(!t)return new a(this._sum,{...this._users});let e=0;const s=Object.keys(this._users).reduce((s,a)=>(t.isApplicable(a)&&(e+=this._users[a],s[a]=this._users[a]),s),{});return new a(e,s)}merge(t){return t&&(this._sum+=t._sum,Object.keys(t._users).forEach(e=>{this._users[e]=(this._users[e]||0)+t._users[e]})),this}split(t){return this._sum-=t._sum,Object.keys(t._users).forEach(e=>{this._users[e]&&(this._users[e]-=t._users[e]),this._users[e]<=0&&delete this._users[e]}),this}}e.exports=a},{}],"tachikomas/DateTime":[function(t,e,s){(function(s){(function(){const a=t("../../../helpers/constants"),i=t("../../../helpers/signals").signals,moment="undefined"!=typeof window?window.moment:void 0!==s?s.moment:null;e.exports=class{constructor(t){this.id=t,this.dom=document.getElementById(t),this.timeSelector=flatpickr(this.dom,{dateFormat:"Y-m-d H:i",enableTime:!0,allowInput:!0,clickOpens:!0,time_24hr:!0,minDate:"2020-01-01 00:00",defaultDate:moment().toDate(),onValueUpdate:_.debounce(()=>i.dispatch({event:"date.change"},1e3))})}get(){return moment(this.timeSelector.selectedDates[0])}set(t){this.timeSelector.setDate([t.format(a.MOMENT_DISPLAY_FORMAT)],!0)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../helpers/constants":"tachikomas/constants","../../../helpers/signals":"tachikomas/signals"}],"tachikomas/Filter":[function(t,e,s){const a=t("../../../singletons/users"),i=t("../../../singletons/twitchClient");e.exports=class{constructor(t){if(this._searchString=(t||"").trim().toLowerCase(),this._searchString.startsWith(":"))switch(this._searchString){case":following":this.isApplicable=this._isFollowing;break;case":notfollowing":this.isApplicable=this._isNotFollowing;break;default:this.isApplicable=()=>!0}else this.isApplicable=this._isStringIncluded}_isFollowing(t){const e=a.getUserByName(t);if(e)return e.isFollowing(i.getChannelID())}_isNotFollowing(t){const e=this._isFollowing(t);if(void 0!==e)return!e}_isStringIncluded(t){return!this._searchString||t.toLowerCase().indexOf(this._searchString)>-1}isEqual(t){return t&&this._searchString===t._searchString}}},{"../../../singletons/twitchClient":"tachikomas/twitchClient","../../../singletons/users":"tachikomas/users"}],"tachikomas/MysterySubGift":[function(t,e,s){const a=t("./Sub");e.exports=class extends a{constructor(t,e,s){super(t,e,0),delete this.months,delete this.totalMonths,this.numSubs=s||t.numbOfSubs}}},{"./Sub":"tachikomas/Sub"}],"tachikomas/ReSub":[function(t,e,s){const a=t("./Sub");e.exports=class extends a{constructor(t,e,s){super(t,e,s)}}},{"./Sub":"tachikomas/Sub"}],"tachikomas/SubGift":[function(t,e,s){const a=t("./Sub");e.exports=class extends a{constructor(t,e,s){super(t,s,e),this.recipientDisplayName=t["msg-param-recipient-display-name"]||t.recipientDisplayName,this.recipientID=t["msg-param-recipient-id"]||t.recipientID}}},{"./Sub":"tachikomas/Sub"}],"tachikomas/Sub":[function(t,e,s){const a=t("./Common");e.exports=class extends a{constructor(t,e,s){super(t),this.months=s||t.months,this.totalMonths=t["msg-param-cumulative-months"]||t.totalMonths,this.subType=e?(t=>{if(t)return t.prime?"prime":t.planName})(e):t.subType,this.subRank=e?(t=>{if(t)return t.plan})(e):t.subRank}}},{"./Common":"tachikomas/Common"}],"tachikomas/User":[function(t,e,s){const a=t("../../helpers/constants").CSS_UNKNOWN;e.exports=class{constructor(t,e,s){this._id=t,this._userName=e,this.userNameCSSClass=a,s&&(this._follows=new Set(Object.keys(s).map(t=>parseInt(t))))}getID(){return this._id}getUserName(){return this._userName}setID(t){this._id=t}addFollows(t){t&&(this._follows||(this._follows=new Set),(t.data||[]).forEach(t=>this._follows.add(parseInt(t.to_id))))}isFollowing(t){if(this._follows)return this._follows.has(t)}isApplicable(t){return this._userName.toLowerCase().indexOf(t)>-1}}},{"../../helpers/constants":"tachikomas/constants"}],"tachikomas/api":[function(t,e,s){(function(s){(function(){const a=t("../env"),moment="undefined"!=typeof window?window.moment:void 0!==s?s.moment:null,i=t("http-status-codes").StatusCodes,n=t("../helpers/constants"),o=t("../helpers/signals").signals,h="undefined"!=typeof window?window.pako:void 0!==s?s.pako:null,r={headers:{"Client-ID":a.CLIENT_ID,Accept:"application/vnd.twitchtv.v5+json"}};const c=new class{constructor(){this.reset()}reset(){this._waitForTimeOut&&clearTimeout(this._waitForTimeOut),this._waitForTimeOut=null,this.waitForReset=null}async _makeAPIQuery(t,e){this.waitForReset&&(await this.waitForReset,this.waitForReset=null);const s=await fetch(t,e||r),a=parseInt(s.headers.get(n.RATELIMIT_REMAINING)||10),c=moment().unix();let l=parseInt(s.headers.get(n.RATELIMIT_RESET)||c+n.MAX_AWAIT_DURATION_SEC);if(0===a||s.status===i.TOO_MANY_REQUESTS){if(console.warn(`too many requests! ${l} ${s.headers}`),!this.waitForReset){const t=Math.min(l-c,n.MAX_AWAIT_DURATION_SEC);l=c+t,this.waitForReset=new Promise(e=>{this._waitForTimeOut=setTimeout(()=>{e(),o.dispatch({event:"api.unthrottled"})},1e3*t)})}throw{status:s.status,msg:"too many requests",resetAt:l}}if(!s.ok)throw console.warn("query failed!"),{status:s.status,msg:"query failed",resetAt:l};return s.headers.get("Content-Type").indexOf("gzip")>-1?JSON.parse(h.ungzip(await s.arrayBuffer(),{to:"string"})):await s.json()}async queryTwitchApi(t,e){const s=`${a.TWITCH_ENDPOINT}/${t}`;return this._makeAPIQuery(s,e)}async queryTmiApi(t){const e=`${a.TMI_ENDPOINT}/${t}`;return(await fetch(e)).json()}};e.exports=c}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../env":"tachikomas/env","../helpers/constants":"tachikomas/constants","../helpers/signals":"tachikomas/signals","http-status-codes":void 0}],"tachikomas/auth":[function(t,e,s){const a=t("../env"),i=t("../helpers/signals").signals,n="scope=user:read:email+bits:read+moderation:read+channel:read:subscriptions+analytics:read:games";const o=new class{constructor(){try{this._authToken=JSON.parse(localStorage.getItem("auth"))}catch(t){this._authToken=void 0,console.warn("failed to parse localstorage cache",t)}}_setAuthToken(t){t&&(this._authToken=t,localStorage.setItem("auth",JSON.stringify(this._authToken)))}async _authWithSecret(){if(!a.CLIENT_SECRET)return;const t=await fetch(`${a.TWITCH_ENDPOINT}/oauth2/token?client_id=${a.CLIENT_ID}&client_secret=${a.CLIENT_SECRET}&grant_type=client_credentials&${n}`,{method:"POST"}),e=await t.json();this._setAuthToken(e.access_token)}async authenticate(t){if(t)this._setAuthToken(t.get("access_token"));else{if(!a.CLIENT_SECRET)return`${a.TWITCH_ENDPOINT}/oauth2/authorize?client_id=${a.CLIENT_ID}&redirect_uri=${a.REDIRECT_URL}&response_type=token&${n}`;await this._authWithSecret()}if(this.isAuthenticated()){i.dispatch({event:"draw.nav.auth"});try{const t=await fetch(a.TWITCH_ENDPOINT+"/helix/users",this.getAuthObj()),e=await t.json();e&&(this._user=e.data[0])}catch(t){console.warn("failed to fetch logged in user info: "+t)}this.isBroadcaster()&&i.dispatch({event:"channel.changed",channel:this.getLogin()})}}isAuthenticated(){return Boolean(this._authToken)}isBroadcaster(){return Boolean(this._user&&this._user.broadcaster_type&&""!==this._user.broadcaster_type)}getLogin(){return this._user&&this._user.login}getID(){return this._user&&this._user.id}logout(){this._authToken=void 0,this._user=void 0,localStorage.removeItem("auth"),i.dispatch({event:"draw.nav.auth"})}getAuthObj(){if(this.isAuthenticated())return{headers:{"Client-ID":a.CLIENT_ID,Accept:"application/vnd.twitchtv.v5+json",Authorization:"Bearer "+this._authToken}}}};e.exports=o},{"../env":"tachikomas/env","../helpers/signals":"tachikomas/signals"}],"tachikomas/blanks":[function(t,e,s){const a=t("../../../helpers/constants"),i=t("./DataNode"),n=t("./DataBucket");const o=new class{constructor(){this._sum=0,this._users={},Object.freeze(this)}merge(t){const e=this.getCopy();return e.merge(t),e}getCopy(){return new i(0,{})}split(){return this.getCopy()}};const h=new class{constructor(){this[a.TYPE_CHAT]=o,this[a.TYPE_RESUB]=o,this[a.TYPE_CHEER]=o,this[a.TYPE_SUB]=o,this[a.TYPE_BAN]=o,this[a.TYPE_ANONGIFT]=o,this[a.TYPE_SUBGIFT]=o,this[a.TYPE_SUBMYSTERY]=o,Object.freeze(this)}merge(t){const e=this.getCopy();return e.merge(t),e}getCopy(){const t=new n;return t[a.TYPE_CHAT]=new i,t[a.TYPE_RESUB]=new i,t[a.TYPE_CHEER]=new i,t[a.TYPE_SUB]=new i,t[a.TYPE_BAN]=new i,t[a.TYPE_ANONGIFT]=new i,t[a.TYPE_SUBGIFT]=new i,t[a.TYPE_SUBMYSTERY]=new i,t}split(){return this.getCopy()}};e.exports.blankDataNode=o,e.exports.blankDataBucket=h},{"../../../helpers/constants":"tachikomas/constants","./DataBucket":"tachikomas/DataBucket","./DataNode":"tachikomas/DataNode"}],"tachikomas/channelFollowsFetcher":[function(t,e,s){(function(s){(function(){const _="undefined"!=typeof window?window._:void 0!==s?s._:null,a=t("../../simpletons/auth"),i=t("../../simpletons/api"),n=t("../../helpers/signals").signals;e.exports=new class{constructor(){this._paginations={},this.fetch=_.throttle(this._fetch,5e3)}async _fetch(t){if(!t||"done"===this._paginations[t])return;const e=await a.getAuthObj();try{for(;;){const s="helix/users/follows?first=100&to_id="+t,a=await i.queryTwitchApi(this._paginations[t]?`${s}&after=${this._paginations[t]}`:s,e);if(n.dispatch({event:"fetch.channel.follows.resp",data:a,channelID:t}),!a.pagination||!a.pagination.cursor)return void(this._paginations[t]="done");this._paginations[t]=a.pagination.cursor}}catch(t){console.warn("failed to fetch channel follows",t)}}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../helpers/signals":"tachikomas/signals","../../simpletons/api":"tachikomas/api","../../simpletons/auth":"tachikomas/auth"}],"tachikomas/chartFilter":[function(t,e,s){(function(s){(function(){const a=t("../../../helpers/constants"),i=t("../../../helpers/signals").signals,moment="undefined"!=typeof window?window.moment:void 0!==s?s.moment:null,n=t("../../../helpers/utils"),o=t("./Filter");const h=new class{constructor(){this.reset()}reset(){this._start=moment().set("second",0).set("millisecond",0),this._end=moment().set("second",0).set("millisecond",0),this._searchValue=void 0,this._intervalLevel=a.BUCKET_MIN}update(t){const e={};if(t.start&&(t.start=n.muteSeconds(t.start),this._start&&t.start.unix()===this._start.unix()||(this._start=t.start,e.start=this._start)),t.end&&(t.end=n.muteSeconds(t.end),this._end&&t.end.unix()===this._end.unix()||(this._end=t.end,e.end=this._end)),"searchValue"in t){const s=new o(t.searchValue);s.isEqual(this._filter)||(this._filter=s,e.filter=s)}t.intervalLevel&&t.intervalLevel!==this._intervalLevel&&(this._intervalLevel=t.intervalLevel,e.intervalLevel=this._intervalLevel),Object.keys(e).length>0&&i.dispatch({event:"filter.change",changed:e})}getStartTime(){return this._start}getEndTime(){return this._end}getFilter(){return this._filter}getIntervalLevel(){return this._intervalLevel}setIntervalLevel(t){this._intervalLevel=t}};e.exports=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../helpers/constants":"tachikomas/constants","../../../helpers/signals":"tachikomas/signals","../../../helpers/utils":"tachikomas/utils","./Filter":"tachikomas/Filter"}],"tachikomas/chatsByUsersVC":[function(t,e,s){const a=t("./ChartRoot"),i=t("../../../helpers/constants"),n=t("../../../simpletons/dataCache");const o=new class extends a{constructor(){super({chartDomSelector:"pie-chats-by-users",title:"Chat Counts by User Name",helpContent:"<p>Chats grouped by users<br>\nSum of chats grouped by users.\n</p>"})}reset(){this._labels=[],this._datasets=[]}async _update(){const{channel:t,filter:e,startBucket:s,endBucket:a}=await this._getParameters(),o=n.getTotal(t,s,a,i.TYPE_CHAT,e),h=Object.entries(o._users).sort(([,t],[,e])=>e-t),r=Math.min(h.length,10);for(let t=0;t<r;t++)this._labels[t]=h[t][0],this._datasets[t]=h[t][1];this._labels.length=r,this._datasets.length=r}};e.exports=o},{"../../../helpers/constants":"tachikomas/constants","../../../simpletons/dataCache":"tachikomas/dataCache","./ChartRoot":"tachikomas/ChartRoot"}],"tachikomas/chattersTableVC":[function(t,e,s){(function(s){(function(){const _="undefined"!=typeof window?window._:void 0!==s?s._:null,a=t("../shared/chartFilter"),i=t("../../singletons/users"),n=t("./components/Chatters"),o=["broadcaster","vips","moderators","staff","admins","global_mods","viewers"],h=templates["./hbs/stream/chatters.hbs"];t("../../helpers/signals").domSignals.add(t=>{switch(t.type){case"click":if(t.id.endsWith("-page-right")){const e=t.id.replace("-page-right","");r._chatters[e].toNextPage()}else if(t.id.endsWith("-page-left")){const e=t.id.replace("-page-left","");r._chatters[e].toPreviousPage()}break;case"keyup":"chatters-search"===t.id&&r.onChattersSearchKeyUp()}});const r=new class{constructor(){this.loadChattersTable=_.debounce(this._loadChattersTable.bind(this)),this.onChattersSearchKeyUp=_.debounce(()=>{const t=document.getElementById("chatters-search").value;a.update({searchValue:t})},500)}_loadChattersTable(){this._chatters=this._chatters||{};for(const[t,e]of Object.entries(i.getViewers())||{})this._chatters[t]?this._chatters[t].update(e):this._chatters[t]=new n(t,e)}initialize(){this.destroy(),document.getElementById("chatters-table").innerHTML=h(o),this.chattersAutocomplete=new Awesomplete(document.getElementById("chatters-search"),{minChars:1,maxItems:10,autoFirst:!0,list:[":following",":notfollowing"]}),this._helpDom=new BSN.Popover(document.getElementById("chatters-help"),{title:"Chatters View",content:"Displays current chatters in the channel synchrnonized at every minute.</br>\n            </br>\n            Chatters search can search via chatters name or any of the following flags.</br>\n            Search is case insensitive.</br>\n            <ul>\n                <li><code>:following</code></li>\n                <li><code>:notfollowing</code></li>\n            </ul>",placement:"left"})}updateChattersList(){for(const t in this._chatters)this._chatters[t].updateChattersList()}destroy(){this.bsnChattersSearch&&(this.bsnChattersSearch.dispose(),this.bsnChattersSearch=void 0)}};e.exports=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../helpers/signals":"tachikomas/signals","../../singletons/users":"tachikomas/users","../shared/chartFilter":"tachikomas/chartFilter","./components/Chatters":"tachikomas/Chatters"}],"tachikomas/constants":[function(t,e,s){e.exports=Object.freeze({MY_CONSTANT:"some value",ANOTHER_CONSTANT:"another value",TYPE_CHAT:0,TYPE_RESUB:1,TYPE_CHEER:2,TYPE_SUB:3,TYPE_BAN:4,TYPE_ANONGIFT:5,TYPE_SUBGIFT:6,TYPE_SUBMYSTERY:7,NUM_TYPES:8,CHART_LABEL:["chat","re-subscription","cheer","subscription","ban","anonymous gift","subscription gift","subscription mystery"],CHART_BACKGROUND_COLOR:["rgb(255, 255, 0, 0.3)","rgb(153, 255, 51, 0.3)","rgb(51, 255, 255, 0.3)","rgb(0, 128, 225, 0.3)","rgb(255, 51, 153, 0.3)","rgb(102, 0, 204, 0.3)","rgb(255, 128, 0, 0.3)","rgb(128, 128, 128, 0.3)"],CHART_BORDER_COLOR:["rgb(255, 255, 0, 1.0)","rgb(153, 255, 51, 1.0)","rgb(51, 255, 255, 1.0)","rgb(0, 128, 225, 1.0)","rgb(255, 51, 153, 1.0)","rgb(102, 0, 204, 1.0)","rgb(255, 128, 0, 1.0)","rgb(128, 128, 128, 1.0)"],KEY_AGG:"agg",KEY_UNIQUE_USERS:"unique_users",KEY_RAWS:"raws",KEY_USERS:"users",KEY_CURRENT:"_current",KEY_STREAMLEVEL:"streamLevel",TIMEFORMAT_DISPLAY:"YYYY/MM/DD HH:mm",KEY_CHATTERS:"chatters",KEY_CHATTERS_UPDATED_AT:"chatters_updated_at",NUM_CHATTERS_DISPLAY:250,KEY_BROADCASTER:"broadcaster",KEY_VIPS:"vips",KEY_MODERATORS:"moderators",KEY_STAFF:"staff",KEY_ADMIN:"admins",KEY_GLOBAL_MODS:"global_mods",KEY_VIEWERS:"viewers",PIE_NUM_USERS_TO_SHOW:10,BUCKET_MIN:60,BUCKET_FIVE:300,BUCKET_HOUR:3600,BUCKET_DAY:86400,INTERVAL_BUCKETS:[60,300,3600,86400],INTERVAL_BUCKETS_STRING:["1 minute","5 minutes","1 hour","1 day"],BUCKET_LAST:86400,SUGGESTED_DATA_COUNT:150,TABS_OPTIONS:["stream"],AUTH_NO_AUTH:-1,AUTH_EXPIRED:0,AUTH_VALID:1,HELP_EMAIL:"help@sonso.io",FAILED_USER_GRACE_PERIOD:3600,USERS_SYNC_VALID_DURATION:604800,RATELIMIT_REMAINING:"Ratelimit-Remaining",RATELIMIT_RESET:"Ratelimit-Reset",MAX_AWAIT_DURATION_SEC:15,TIMESTAMP_SEC_ATTR:"timestamp_sec",MAX_PARALLEL_USER_FOLLOWS_FETCH_LIMIT:10,MOMENT_DISPLAY_FORMAT:"YYYY-MM-DD HH:mm",CSS_UNKNOWN:"text-muted",CSS_FOLLOWING:"stream-following",CSS_NOT_FOLLOWING:"stream-not-following",MAX_VIEWERS_COUNTS_FOR_PROCESS:1e3})},{}],"tachikomas/dataCache":[function(t,e,s){const a=t("./models/DataChannel"),i=t("./models/DataNode"),n=t("../../helpers/signals").signals;const o=new class{constructor(){this.reset()}reset(){this._data={}}_isValidRaw(t){return t.displayName?!!t.timestamp||(console.warn("missing timestamp",t),!1):(console.warn("missing displayname",t),!1)}_ensureChannelExists(t){this._data[t]||(this._data[t]=new a)}add(t,e){this._isValidRaw(e)&&(this._ensureChannelExists(t),this._data[t].add(e),n.dispatch({event:"data.cache.updated"}))}get(t,e,s,a){return this._ensureChannelExists(t),this._data[t].get(e,s,a)}getTotal(t,e,s,a,i){return this._ensureChannelExists(t),this._data[t].getTotal(e,s,a,i)}getNewDataNode(){return new i}};e.exports=o},{"../../helpers/signals":"tachikomas/signals","./models/DataChannel":"tachikomas/DataChannel","./models/DataNode":"tachikomas/DataNode"}],"tachikomas/dateTimeRangeVC":[function(t,e,s){const a=t("../../helpers/utils"),i=t("./components/DateTime"),n=t("../shared/chartFilter");let o;t("../../helpers/signals").domSignals.add(t=>{switch(t.type){case"click":h._timeReset()}});const h=new class{constructor(){this.defaultStart=a.getNow(),this.isLive=!0,window.addEventListener("focus",this._onWindowFocus.bind(this))}_isValid(){return this.start&&this.end}_setIsLive(){const t=this.end.get().unix()-a.getNow().add(-1,"minutes").unix();this.isLive=t>=0&&t<=60}_timeReset(){this.start.set(this.defaultStart),this.end.set(a.getNow())}_onWindowFocus(){this.isLive&&this._isValid()&&this._timeReset()}setDate(){if(!this._isValid())return;const t=this.start.get(),e=this.end.get();if(e.unix()<t.unix())return this.start.set(e),void this.end.set(t);this._setIsLive(),n.update({start:t,end:e})}minProgressed(){this.isLive&&this._isValid()&&this.end.set(a.getNow())}initialize(){this.destroy(),document.getElementById("time-selectors").innerHTML=templates["./hbs/stream/date-time-range.hbs"](),this.start=new i("time-start"),this.end=new i("time-end"),new BSN.Popover(document.getElementById("time-help"),{title:"Date range",content:"Data display time window.",delay:500,placement:"bottom"}),new BSN.Popover(document.getElementById("time-reset-help"),{title:"Reset time",content:"Reset time window to page load time to now",delay:500,placement:"bottom"})}destroy(){o&&(clearInterval(o),o=void 0),this.start&&(this.start.destroy(),this.start=void 0),this.end&&(this.end.destroy(),this.end=void 0)}};e.exports=h},{"../../helpers/signals":"tachikomas/signals","../../helpers/utils":"tachikomas/utils","../shared/chartFilter":"tachikomas/chartFilter","./components/DateTime":"tachikomas/DateTime"}],"tachikomas/env":[function(t,e,s){e.exports={ENVIRONMENT:"local",HOST_ENDPOINT:".",TWITCH_ENDPOINT:"http://127.0.0.1:5556",TMI_ENDPOINT:"http://127.0.0.1:5556",SERVICE:"tachikomas",CLIENT_ID:"nrmkyj3jbq4eukbuunluz5yygi9t7v",GIT_HASH:"0abc10c",TAG:"local-0abc10c"}},{}],"tachikomas/events":[function(t,e,s){e.exports={AnonGift:t("./AnonGift"),Ban:t("./Ban"),Cheer:t("./Cheer"),Chat:t("./Chat"),MysterySubGift:t("./MysterySubGift"),ReSub:t("./ReSub"),SubGift:t("./SubGift"),Sub:t("./Sub")}},{"./AnonGift":"tachikomas/AnonGift","./Ban":"tachikomas/Ban","./Chat":"tachikomas/Chat","./Cheer":"tachikomas/Cheer","./MysterySubGift":"tachikomas/MysterySubGift","./ReSub":"tachikomas/ReSub","./Sub":"tachikomas/Sub","./SubGift":"tachikomas/SubGift"}],"tachikomas/followedStreamersVC":[function(t,e,s){const a=t("../../shared/chartFilter"),i=t("./ChartRoot");const n=new class extends i{constructor(){super({type:"horizontalBar",title:"Top followed streamers by viewers",chartDomSelector:"pie-followed-streamers",helpContent:"<p>Viewer's top followed streamers<br>\nTop 10 streamers followed among viewers.\n</p>",updateThrottleTime:5e3,signalListener:t=>{switch(t.event){case"channel.input.update":this.reset();break;case"stream.load.ready":this.enable(),this.reset();break;case"stream.cleanup":this.disable();break;case"fetch.user.follows.resp":this._enabled&&(this._pushToProcess(t.data),this.update())}}})}reset(){this._map={},this._labels=[],this._datasets=[]}_pushToProcess(t){t.data.forEach(t=>{this._map[t.to_name]=(this._map[t.to_name]||0)+1})}_update(){this._labels=[],this._datasets=[];const t=a.getFilter();for(const[e,s]of Object.entries(this._map)){if(t&&!t.isApplicable(e))continue;const a=(this._datasets.length>=10?10:this._datasets.length)-1;if(this._datasets.length>=10&&s<this._datasets[a])continue;let i=0;for(;i<this._datasets.length&&!(s>this._datasets[i]);i++);this._datasets.splice(i,0,s),this._labels.splice(i,0,e)}this._datasets.length=Math.min(this._datasets.length,10),this._labels.length=Math.min(this._datasets.length,10)}};e.exports=n},{"../../shared/chartFilter":"tachikomas/chartFilter","./ChartRoot":"tachikomas/ChartRoot"}],"tachikomas/main":[function(t,e,s){(function(e){(function(){const s=t("./helpers/signals").signals,a=t("./helpers/signals").domSignals,i=t("./helpers/utils"),n=t("./helpers/constants"),moment="undefined"!=typeof window?window.moment:void 0!==e?e.moment:null,o=t("./singletons/twitchClient"),h=t("./simpletons/auth"),r=t("./singletons/users");let c={};window.env=t("./env.js"),window.onload=()=>{s.dispatch({event:"draw.nav.auth"}),document.querySelectorAll("ul.navbar-nav a").forEach(t=>{t.onclick=e=>{e.preventDefault(),c.tab&&document.getElementById("nav-"+c.tab).classList.remove("active"),window.location.hash=t.hash,l()}}),l()},window.authenticate=()=>{if(h.isAuthenticated())return;const t=h.authenticate();t&&(window.location=t)},window.authLogout=()=>{h.isAuthenticated()&&h.logout()};const l=async()=>{const t=i.extractTabObj(window.location.hash);document.getElementById("nav-"+t.tab).classList.add("active"),c.tab!==t.tab&&(c.tab&&(c.event=c.tab+".cleanup",s.dispatch(c)),s.dispatch({event:t.tab+".load",tab:t})),c=t};if(window.getCurrentTab=()=>c,window.location.hash){const t=new URLSearchParams(window.location.hash.substr(1));h.authenticate(t)}const d=()=>{const t=i.getNow().add(1,"minute").valueOf()-moment.now();window.minTopTimeoutEvent=setTimeout(()=>{s.dispatch({event:"main.minute.top"})},t+5)};d(),window.minIntervalEvent=setInterval(()=>{s.dispatch({event:"main.minute",currentTab:c,channel:o.getChannel()}),d()},6e4),window.domEvent=(t,e)=>{a.dispatch({id:e||u(t.target),type:t.type,event:t})};const u=t=>t.id?t.id:t.parentElement?u(t.parentElement):"undefined";Handlebars.registerHelper("userFollowsCSS",t=>{const e=r.getUserByName(t);if(!e)return n.CSS_UNKNOWN;switch(e.isFollowing(o.getChannelID())){case!0:return n.CSS_FOLLOWING;case!1:return n.CSS_NOT_FOLLOWING;default:return n.CSS_UNKNOWN}}),s.add(t=>{if(t){if(t.alert&&t.alert.body)return document.getElementById("alerts").insertAdjacentHTML("afterbegin",templates["./hbs/shared/alerts.hbs"](t.alert)),void new BSN.Alert(document.querySelector(".alert"));switch(t.event){case"draw.nav.auth":document.getElementById("nav-auth").innerHTML=templates["./hbs/components/nav-auth.hbs"](h)}}})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./env.js":"tachikomas/env","./helpers/constants":"tachikomas/constants","./helpers/signals":"tachikomas/signals","./helpers/utils":"tachikomas/utils","./simpletons/auth":"tachikomas/auth","./singletons/twitchClient":"tachikomas/twitchClient","./singletons/users":"tachikomas/users"}],"tachikomas/navOptionVC":[function(t,e,s){const a=t("../../helpers/signals").signals,i=t("../../singletons/twitchClient"),n=t("../../singletons/twitchAPI"),o=t("../../helpers/constants"),h=t("../shared/chartFilter");t("../../helpers/signals").domSignals.add(t=>{if("click"===t.type&&t.id.endsWith("-interval"))r._intervalClickEvent(t.event);else if("channel-input"===t.id)switch(t.type){case"keyup":r._onChannelInputKeyUp(t.event);break;case"click":r._refreshList();break;case"focusout":case"channel.input.update":r.syncChannelInput()}else if("channel-refresh"===t.id)switch(t.type){case"click":i.changeToRandomFeaturedStream()}});const r=new class{constructor(){this.channelInputAutoComplete=void 0,this.toDsipose=[],this.fetchList=_.debounce(this._fetchList.bind(this),500,{leading:!1}),this.streamSelect=_.debounce(this._streamSelect.bind(this),500,{leading:!1}),this.populateStreamInfo=_.debounce(this._populateStreamInfo.bind(this),500,{leading:!1}),this.syncChannelInput=_.debounce(()=>{this.channelInputAutoComplete.input.value=i.getChannel()},250,{leading:!1})}_onChannelInputKeyUp(t){const e=this.channelInputAutoComplete.input.value;if(13===t.keyCode||t.awesompleteSelect)return this.lastSearchedChannel=e,void this.streamSelect();this._refreshList()}_refreshList(){const t=this.channelInputAutoComplete.input.value;this.lastSearchedChannel!==t?(this.lastSearchedChannel=t,this.fetchList()):this.channelInputAutoComplete.open()}async _fetchList(){const t=await n.getChannelSearch(this.lastSearchedChannel);this.channelInputAutoComplete.list=(t.data||[]).map(t=>t.display_name)}async _streamSelect(){try{await i.changeChannel(this.lastSearchedChannel),this.populateStreamInfo()}catch(t){a.dispatch({alert:{body:`Requested ${this.lastSearchedChannel} is not a valid channel.`}})}this.channelInputAutoComplete.close()}async _populateStreamInfo(){const t=i.getChannel();try{this.channelInputAutoComplete.input.value=this.lastSearchedChannel||t,document.getElementById("embeded-twitch-channel").innerText=t,this.streamInfo=await n.getChannelInfo(t),this.streamInfo&&this.streamInfo.data&&this.streamInfo.data.length>0?document.getElementById("embeded-twitch-desc").innerHTML=""+this.streamInfo.data[0].title:document.getElementById("embeded-twitch-desc").innerHTML="(inactive...)"}catch(e){document.getElementById("embeded-twitch-desc").innerText=t+"'s stream"}}_intervalClickEvent(t){const e={event:"filter.interval.change",label:t.srcElement.innerHTML};switch(e.label){case"1 minute":e.intervalLevel=o.BUCKET_MIN;break;case"5 minutes":e.intervalLevel=o.BUCKET_FIVE;break;case"1 hour":e.intervalLevel=o.BUCKET_HOUR;break;case"1 day":e.intervalLevel=o.BUCKET_DAY}document.getElementById("interval-selector-btn").innerText=e.label,h.update({intervalLevel:e.intervalLevel})}initialize(){this.destroy(),document.getElementById("nav-options").innerHTML=templates["./hbs/stream/nav-options.hbs"](),this.toDsipose.push(new BSN.Dropdown(document.getElementById("interval-selector"))),this.toDsipose.push(new BSN.Popover(document.getElementById("interval-selector-help"),{title:"Timeseries interval level",content:"Select timeseries interval level.",delay:500,placement:"bottom"})),this.toDsipose.push(new BSN.Popover(document.getElementById("channel-refresh-help"),{title:"Randomize channel ",content:"Randomize channel based on featured streams API call.",delay:500,placement:"bottom"})),this.channelInputAutoComplete=new Awesomplete(document.getElementById("channel-input"),{minChars:4,maxItems:10,autoFirst:!0}),this.channelInputAutoComplete.input.addEventListener("awesomplete-selectcomplete",this._onChannelInputKeyUp.bind(this))}destroy(){this.channelInputAutoComplete&&(this.channelInputAutoComplete.destroy(),this.channelInputAutoComplete=void 0),this.toDsipose.forEach(t=>t.dispose()),this.toDsipose.length=0}};e.exports=r},{"../../helpers/constants":"tachikomas/constants","../../helpers/signals":"tachikomas/signals","../../singletons/twitchAPI":"tachikomas/twitchAPI","../../singletons/twitchClient":"tachikomas/twitchClient","../shared/chartFilter":"tachikomas/chartFilter"}],"tachikomas/proceedsByTypesVC":[function(t,e,s){const a=t("./ChartRoot"),i=t("../../../helpers/constants"),n=t("../../../simpletons/dataCache");const o=new class extends a{constructor(){super({type:"bar",chartDomSelector:"pie-proceeds",title:"Overall Proceeds",helpContent:"<p>Displays overall proceeds<br>\n<ul>\n<li>100 Cheers count</li>\n<li>Subscription count</li>\n<li>Re-Subscription count</li>\n<li>Subscription Gifts count</li>\n<li>Mystery Subscription count</li>\n</ul>\n</p>"}),this._labels=Object.freeze(["100 Cheer","Subs","Resubs","Sub Gifts","Sub Mystery"]),this._messageTypes=Object.freeze([i.TYPE_CHEER,i.TYPE_SUB,i.TYPE_RESUB,i.TYPE_SUBGIFT,i.TYPE_SUBMYSTERY]),this._backgroundColor=Object.freeze(this._messageTypes.map(t=>i.CHART_BACKGROUND_COLOR[t])),this._borderColor=Object.freeze(this._messageTypes.map(t=>i.CHART_BACKGROUND_COLOR[t]))}reset(){this._datasets=[0,0,0,0,0]}async _update(){const{channel:t,filter:e,startBucket:s,endBucket:a}=await this._getParameters();this._datasets[0]=n.getTotal(t,s,a,i.TYPE_CHEER,e)._sum,this._datasets[1]=n.getTotal(t,s,a,i.TYPE_SUB,e)._sum,this._datasets[2]=n.getTotal(t,s,a,i.TYPE_RESUB,e)._sum,this._datasets[3]=n.getTotal(t,s,a,i.TYPE_SUBGIFT,e)._sum,this._datasets[4]=n.getTotal(t,s,a,i.TYPE_SUBMYSTERY,e)._sum}_getBackgroundColor(){return this._backgroundColor}_getBorderColor(){return this._borderColor}};e.exports=o},{"../../../helpers/constants":"tachikomas/constants","../../../simpletons/dataCache":"tachikomas/dataCache","./ChartRoot":"tachikomas/ChartRoot"}],"tachikomas/proceedsByUsersVC":[function(t,e,s){const a=t("./ChartRoot"),i=t("../../../helpers/constants"),n=t("../../../simpletons/dataCache");const o=new class extends a{constructor(){super({chartDomSelector:"pie-proceeds-by-users",title:"Proceeds by User Name",helpContent:"<p>Displays proceeds by users<br>\n<ul>\n<li>100 Cheers</li>\n<li>Subscription count</li>\n<li>Re-Subscription count</li>\n<li>Subscription Gifts count</li>\n<li>Mystery Subscription count</li>\n</ul>\n</p>"}),this._proceedsTypesToProcess=Object.freeze([i.TYPE_CHEER,i.TYPE_SUB,i.TYPE_RESUB,i.TYPE_SUBGIFT,i.TYPE_SUBMYSTERY])}reset(){this._labels=[],this._datasets=[],this._sumByType=[],this._displayLimit=10}async _update(){const{channel:t,filter:e,startBucket:s,endBucket:a}=await this._getParameters(),i={},o=this._proceedsTypesToProcess.reduce((o,h)=>{const r=n.getTotal(t,s,a,h,e);return i[h]=r,o.merge(r)},n.getNewDataNode()),h=Object.entries(o._users).sort(([,t],[,e])=>e-t),r=Math.min(h.length,this._displayLimit);for(let t=0;t<r;t++){const e=h[t][0];this._labels[t]=e,this._datasets[t]=h[t][1],this._sumByType[t]=this._proceedsTypesToProcess.reduce((t,s)=>{const a=i[s]._users[e];return a&&(t[s]=a),t},{})}this._labels.length=r,this._datasets.length=r,this._sumByType.length=r}afterLabel(t){const e=this._labels.indexOf(t),s=this._sumByType[e];return Object.keys(s||{}).map(t=>{const e=s[t];return`  ${i.CHART_LABEL[t]}: ${t==i.TYPE_CHEER?100*e:e}`})}};e.exports=o},{"../../../helpers/constants":"tachikomas/constants","../../../simpletons/dataCache":"tachikomas/dataCache","./ChartRoot":"tachikomas/ChartRoot"}],"tachikomas/signals":[function(t,e,s){const a=t("micro-signals").Signal;e.exports={signals:new a,domSignals:new a}},{"micro-signals":void 0}],"tachikomas/stream":[function(t,e,s){const a=t("../../helpers/signals").signals,i=t("./chattersTableVC"),n=t("./twitchEmbededVC"),o=t("./navOptionVC"),h=t("./dateTimeRangeVC"),r=t("../shared/chartFilter");a.add(async t=>{switch(t.event){case"stream.load":document.getElementById("main").innerHTML=templates["./hbs/stream/index.hbs"](),i.initialize(),o.populateStreamInfo(),o.initialize(),n.initialize(),h.initialize(),a.dispatch({event:"stream.load.ready"});break;case"chatters.data.update.data":i.loadChattersTable();break;case"filter.change":t.changed&&t.changed.searchValue&&i.loadChattersTable(),t.changed&&t.changed.channel&&"stream"===getCurrentTab().tab&&o.populateStreamInfo();break;case"filter.interval.change":document.getElementById("interval-selector-btn").innerText=t.label,r.update({intervalLevel:t.intervalLevel});break;case"main.minute":o.populateStreamInfo();break;case"date.change":h.setDate();break;case"main.minute.top":h.minProgressed();break;case"channel.input.update":o.populateStreamInfo();break;case"stream.cleanup":o.destroy(),h.destroy(),i.destroy(),r.destroy();break;case"chatters.data.update.partial":i.updateChattersList()}})},{"../../helpers/signals":"tachikomas/signals","../shared/chartFilter":"tachikomas/chartFilter","./chattersTableVC":"tachikomas/chattersTableVC","./dateTimeRangeVC":"tachikomas/dateTimeRangeVC","./navOptionVC":"tachikomas/navOptionVC","./twitchEmbededVC":"tachikomas/twitchEmbededVC"}],"tachikomas/timeseriesVC":[function(t,e,s){(function(s){(function(){const a=t("../../shared/chartFilter"),moment="undefined"!=typeof window?window.moment:void 0!==s?s.moment:null,i=t("../../../helpers/constants"),n=t("./ChartRoot"),o=t("../../../simpletons/dataCache");const h=new class extends n{constructor(){super({chartDomSelector:"canvas-timeseries"})}reset(){this._chartLabels=[],this._chartDatasets=[],this._chartObject&&this._chartObject.destroy(),this._chartObject=void 0;for(let t=0;t<i.NUM_TYPES;t++)this._chartDatasets.push({label:i.CHART_LABEL[t],backgroundColor:i.CHART_BACKGROUND_COLOR[t],borderColor:i.CHART_BORDER_COLOR[t],borderWidth:1,data:[],users:[]})}async _update(){const{interval:t,startBucket:e,channel:s,searchValue:a,length:n}=await this._getParameters();for(let h=0;h<n;h++){const n=e+h*t;this._chartLabels[h]=moment.unix(n);const r=o.get(s,n,t,a);for(let t=0;t<i.NUM_TYPES;t++)this._chartDatasets[t].data[h]=r[t]._sum,this._chartDatasets[t].users[h]=r[t]._users}for(let t=0;t<i.NUM_TYPES;t++)this._chartDatasets[t].data.length=n,this._chartDatasets[t].data.length=n,this._chartDatasets[t].users.length=n;this._chartLabels.length=n}_toolTipAfterLabel(t){if(!t)return;const e=this._chartDatasets[t.datasetIndex];if(0===t.yLabel||!a.getFilter()||!e.users||!e.users[t.dataIndex])return;const s=e.users[t.dataIndex];return Object.keys(s).reduce((t,e)=>(t.push(`  ${e}: ${s[e]}`),t),[])}_toolTipLabel(t){return`${t.dataset.label}: ${t.dataset.data[t.dataIndex]}`}_toolTipTitle(t){const e=(t&&t[0]||{}).dataIndex;if(e>=0)return this._chartLabels[e].format(i.TIMEFORMAT_DISPLAY)}_toolTipFilter(t){return t&&"0"!=t.formattedValue}_scaleTicksFontStyle(t){switch(a.getIntervalLevel()){case i.BUCKET_DAY:return 1===t.tick.value.days()?"bold":void 0;case i.BUCKET_HOUR:return 0===t.tick.value.hours()?"bold":void 0;case i.BUCKET_FIVE:return 0===t.tick.value.minutes()?"bold":void 0;case i.BUCKET_MIN:return t.tick.value.minutes()%5==0?"bold":void 0;default:return}}_scaleTicksCallback(t){const e=this._chartLabels[t];if(0===e.hours()&&0===e.minutes())return e.format("M/D");switch(a.getIntervalLevel()){case i.BUCKET_DAY:return e.format("M/D");default:return e.format("HH:mm")}}_updateChartObject(){this._chartObject?(this._chartObject.data.labels=this._chartLabels,this._chartObject.data.datasets=this._chartDatasets,this._chartObject.update()):this._chartObject=new Chart(document.getElementById(this._chartDomSelector),{type:"bar",data:{labels:this._chartLabels,label:"# of Events",datasets:this._chartDatasets},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{display:!0,stacked:!0,ticks:{fontColor:"#7d7d7d",fontSize:14,fontStyle:this._scaleTicksFontStyle.bind(this),callback:this._scaleTicksCallback.bind(this)},gridLines:{display:!0,color:"#7d7d7d"}},y:{stacked:!0,gridLines:{display:!0,color:"#7d7d7d"},ticks:{fontColor:"#7d7d7d",fontSize:14,stepSize:5}}},plugins:{title:{display:!1},legend:{labels:{display:!0,color:"#7d7d7d"}},tooltip:{intersect:!1,mode:"index",filter:this._toolTipFilter.bind(this),callbacks:{title:this._toolTipTitle.bind(this),label:this._toolTipLabel.bind(this),afterLabel:this._toolTipAfterLabel.bind(this)}}}}})}};e.exports=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../helpers/constants":"tachikomas/constants","../../../simpletons/dataCache":"tachikomas/dataCache","../../shared/chartFilter":"tachikomas/chartFilter","./ChartRoot":"tachikomas/ChartRoot"}],"tachikomas/twitchAPI":[function(t,e,s){const a=t("../simpletons/api"),i=t("../simpletons/auth"),n=/[0-9a-zA-Z][\w]{3,23}/;const o=new class{async getChannelSearch(t){return n.test(t)?await a.queryTwitchApi(`helix/search/channels?query=${t}&first=10`,i.getAuthObj()):{}}async getChannelInfo(t){return await a.queryTwitchApi("helix/streams?user_login="+t,i.getAuthObj())}};e.exports=o},{"../simpletons/api":"tachikomas/api","../simpletons/auth":"tachikomas/auth"}],"tachikomas/twitchClient":[function(t,e,s){(function(s){(function(){const a=t("tmi.js"),_="undefined"!=typeof window?window._:void 0!==s?s._:null,i=t("../models/events"),n=t("../helpers/signals").signals,o=t("../helpers/constants"),h=t("../simpletons/auth"),r=t("../simpletons/api"),c=t("../simpletons/dataCache");n.add(t=>{switch(t.event){case"chatters.data.fetch":case"main.minute":l.updateViewersCache();break;case"stream.cleanup":l._disable();break;case"stream.load.ready":l._enable();break;case"channel.changed":l.changeChannel(t.channel)}});const l=new class{constructor(){this._channel=void 0,this._channelID=void 0,this._enabled=!1,this.updateViewersCache=_.debounce(this._updateViewersCache.bind(this),500,{leading:!1})}async _initializeClient(){this._client||(this.getChannel()||(localStorage.getItem("channel")?this._setChannel(localStorage.getItem("channel")):h.isBroadcaster()?(this._setChannel(h.getLogin()),this._setChannelID(h.getID())):await this.changeToRandomFeaturedStream()),this.getChannel()&&!this.getChannelID()&&(localStorage.getItem("channel-id")?this._setChannelID(parseInt(localStorage.getItem("channel-id"))):this._setChannelID()),this._client=new a.Client({connection:{secure:!0,reconnect:!0,maxReconnectInterval:1e3,reconnectInterval:1e3,reconnectDecay:1,timeout:5e3},channels:[this.getChannel()]}),this._emitDataChange=_.throttle(()=>{n.dispatch({event:"chats.data.update"})},250),this._client.on("chat",(t,e,s,a)=>{this._processChatMessage(t,i.Chat,e)}),this._client.on("resub",(t,e,s,a,n,o)=>{this._processChatMessage(t,i.ReSub,n,o,s)}),this._client.on("subscription",(t,e,s,a,n)=>{this._processChatMessage(t,i.Sub,n,s,0)}),this._client.on("cheer",(t,e,s)=>{this._processChatMessage(t,i.Cheer,e)}),this._client.on("ban",(t,e,s,a)=>{this._processChatMessage(t,i.Ban,a)}),this._client.on("anongiftpaidupgrade",(t,e,s)=>{this._processChatMessage(t,i.AnonGift,s)}),this._client.on("subgift",(t,e,s,a,n,o)=>{this._processChatMessage(t,i.SubGift,o,n,s)}),this._client.on("submysterygift",(t,e,s,a,n)=>{this._processChatMessage(t,i.MysterySubGift,n,a,s)}),this._client.connect(),n.dispatch({event:"channel.input.update"}))}async changeChannel(t,e){this.getChannel()!==t&&(await this._client.join(t),this.getChannel()&&this._client.part(this.getChannel()),this._setChannel(t),this._setChannelID(e),this.updateViewersCache(),n.dispatch({event:"channel.input.update",data:{id:this.getChannelID(),channel:this.getChannel()}}))}_processChatMessage(t,e,s,a,i,n){const o=new e(s,a,i,n);"#"===t.charAt(0)?c.add(t.substring(1),o):c.add(t,o),this._enabled&&this._emitDataChange()}_disable(){this._enabled=!1}_enable(){this._enabled||(this._enabled=!0,this.updateViewersCache())}async _updateViewersCache(){if(!this._enabled||!this.getChannel())return;const t=await r.queryTmiApi(`group/user/${this.getChannel()}/chatters`);n.dispatch({event:"chatters.data.update",data:t.data[o.KEY_CHATTERS],channelID:this.getChannelID()})}_setChannel(t){this._channel=t,localStorage.setItem("channel",t)}async _setChannelID(t){if(t)this._channelID=t;else{if(!this.getChannel())return;{const t=await r.queryTwitchApi("kraken/users?login="+this.getChannel());this._channelID=parseInt(t.users[0]._id)}}localStorage.setItem("channel-id",this._channelID)}async changeToRandomFeaturedStream(){try{const t=(await r.queryTwitchApi("kraken/streams/featured?limit=100")).featured.filter(t=>t.stream.viewers>100&&t.stream.viewers<=o.MAX_VIEWERS_COUNTS_FOR_PROCESS),e=t[Math.floor(Math.random()*t.length)];this.changeChannel(e.stream.channel.name,e.stream.channel._id)}catch(t){this.changeChannel("xqcow",71092938)}}getChannel(){return this._channel}getChannelID(){return this._channelID}};Promise.all([l._initializeClient()]),e.exports=l}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../helpers/constants":"tachikomas/constants","../helpers/signals":"tachikomas/signals","../models/events":"tachikomas/events","../simpletons/api":"tachikomas/api","../simpletons/auth":"tachikomas/auth","../simpletons/dataCache":"tachikomas/dataCache","tmi.js":void 0}],"tachikomas/twitchEmbededVC":[function(t,e,s){const a=t("../../singletons/twitchClient");t("../../helpers/signals").domSignals.add(t=>{"click"===t.type&&"embeded-twitch-collapse"===t.id&&i.toggleEmbededTwitch()});const i=new class{constructor(){this.lastSearchedChannel=void 0,this.embededTwitch=void 0,this.twitchEmbededCollapse=void 0,this.streamInfo=void 0,this.toggleEmbededTwitch=_.debounce(this._toggleEmbededTwitch.bind(this),1e3,{leading:!1})}_getIsOpenTwitchEmbeded(){const t=localStorage.getItem("isOpenTwitchEmbeded");return!t||JSON.parse(t)}_handleEmbededTwitch(){this._getIsOpenTwitchEmbeded()?this.embededTwitch=new Twitch.Embed("twitch-embed",{width:"100%",height:"100%",channel:a.getChannel(),autoplay:!0,muted:!0,allowfullscreen:!1}):this.embededTwitch&&this.embededTwitch.destroy()}_toggleEmbededTwitch(){const t=document.getElementById("twitch-embed").classList.contains("show");localStorage.setItem("isOpenTwitchEmbeded",JSON.stringify(Boolean(t))),this._handleEmbededTwitch()}initialize(){this.destroy();const t=document.getElementById("embeded-twitch-collapse");this.twitchEmbededCollapse=new BSN.Collapse(t),this._getIsOpenTwitchEmbeded()?this._handleEmbededTwitch():this.twitchEmbededCollapse.hide()}destroy(){this.twitchEmbededCollapse&&(this.twitchEmbededCollapse.dispose(),this.embededTwitch=void 0),this.embededTwitch&&(this.embededTwitch.destroy(),this.embededTwitch=void 0)}};e.exports=i},{"../../helpers/signals":"tachikomas/signals","../../singletons/twitchClient":"tachikomas/twitchClient"}],"tachikomas/userFollowsFetcher":[function(t,e,s){(function(s){(function(){const _="undefined"!=typeof window?window._:void 0!==s?s._:null,a=t("../../simpletons/auth"),i=t("../../simpletons/api"),n=t("../../helpers/signals").signals;const o=new class{constructor(){this.reset(),this._paginations={},this.fetch=_.throttle(this._fetch,5e3)}reset(){this._toFetch=new Set,this._running=0,this._toFetchArray&&(this._toFetchArray.length=0),this._toFetchArray=void 0}add(t){this._toFetch.add(t),this.fetch()}_fetch(){if(this._toFetchArray=Array.from(this._toFetch),0!==this._toFetchArray.length)for(let t=this._running;t<5;t++)this._running++,this._fetchUserFollows()}async _fetchUserFollows(){const t=await a.getAuthObj();for(;;){const e=(this._toFetchArray||[]).shift();if(!e||"done"===this._paginations[e]){this._toFetch.delete(e);break}try{for(;;){const s="helix/users/follows?first=100&from_id="+e,a=await i.queryTwitchApi(this._paginations[e]?`${s}&after=${this._paginations[e]}`:s,t);if(n.dispatch({event:"fetch.user.follows.resp",data:a,userID:e}),!a.pagination||!a.pagination.cursor){this._paginations[e]="done",this._toFetch.delete(e);break}this._paginations[e]=a.pagination.cursor}}catch(t){console.warn("failed to fetch user follows",t);break}}this._running=Math.max(0,this._running-1)}};e.exports=o}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../helpers/signals":"tachikomas/signals","../../simpletons/api":"tachikomas/api","../../simpletons/auth":"tachikomas/auth"}],"tachikomas/userIDFetcher":[function(t,e,s){(function(s){(function(){const _="undefined"!=typeof window?window._:void 0!==s?s._:null,a=t("../../simpletons/auth"),i=t("../../simpletons/api"),n=t("../../helpers/signals").signals;let o=!1;const h=new class{constructor(){this.reset()}reset(){this._names=new Set,this.fetch=_.throttle(this._fetch,2e3)}add(t){this._names.add(t),this.fetch()}async _fetch(){if(o)return;o=!0;const t=Array.from(this._names),e=await a.getAuthObj(),s=[];for(let e=0;e<t.length;e+=100)s.push(t.slice(e,e+100));try{for(const t of s)await this._fetchUserIDsForNames(e,t)}catch(t){console.warn("failed to query for ids",t)}o=!1}async _fetchUserIDsForNames(t,e){const s="helix/users?login="+e.join("&login="),a=await i.queryTwitchApi(s,t);for(const t of a.data)this._names.delete(t.login.toLowerCase());n.dispatch({event:"fetch.user.ids.resp",data:a.data})}};e.exports=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../helpers/signals":"tachikomas/signals","../../simpletons/api":"tachikomas/api","../../simpletons/auth":"tachikomas/auth"}],"tachikomas/users":[function(t,e,s){const a=t("../../helpers/signals").signals,i=t("./User"),n=t("./userIDFetcher"),o=t("./userFollowsFetcher"),h=t("./channelFollowsFetcher"),r=t("../../helpers/constants");a.add(async t=>{switch(t.event){case"chatters.data.update":c.processChattersData(t.data,t.channelID),a.dispatch({event:"chatters.data.update.data"});break;case"fetch.user.ids.resp":c.processUserIDsResp(t.data);break;case"fetch.user.follows.resp":c.processUserFollowsResp(t.userID,t.data);break;case"api.unthrottled":n.fetch(),o.fetch();break;case"channel.input.update":n.reset(),o.reset(),h.fetch(t.data.id);break;case"fetch.channel.follows.resp":c.processChannelFollows(t.channelID,t.data)}});const c=new class{constructor(){this.reset()}reset(){this._viewers={},this._idToUser={},this._nameToUser={},this._channelWarned={}}getUserByID(t){return this._idToUser[t]}getUserByName(t){return this._nameToUser[t]}getViewers(){return this._viewers}processChattersData(t,e){const s={},o=Object.values(t||{}).reduce((t,e)=>e.length+t,0);for(const[e,a]of Object.entries(t||{}))s[e]=a.sort().map(t=>{const e=t.toLowerCase();return this.getUserByName(e)||(this._nameToUser[e]=new i(void 0,t),o<r.MAX_VIEWERS_COUNTS_FOR_PROCESS&&n.add(t)),this.getUserByName[e]});o>=r.MAX_VIEWERS_COUNTS_FOR_PROCESS&&!this._channelWarned[e]&&(this._channelWarned[e]=!0,a.dispatch({alert:{body:`This channel has higher than ${r.MAX_VIEWERS_COUNTS_FOR_PROCESS} viewers.  Halting some data gatherings to conserve API requests.`}})),this._viewers=s}processUserFollowsResp(t,e){this.getUserByID(t).addFollows(e),a.dispatch({event:"chatters.data.update.partial"})}processUserIDsResp(t){for(const e of t){const t=e.login.toLowerCase();if(this.getUserByName(t)){const s=parseInt(e.id);this.getUserByName(t).setID(s),this._idToUser[s]=this.getUserByName(t),o.add(s)}}}processChannelFollows(t,e){e.data.forEach(e=>{const s=e.from_id,a=e.from_name,n=a.toLowerCase(),o=this.getUserByName(n)||this.getUserByID(s)||new i(s,a);o.addFollows({data:[{to_id:t}]}),this._nameToUser[n]=o,this._idToUser[s]=o})}};e.exports=c},{"../../helpers/constants":"tachikomas/constants","../../helpers/signals":"tachikomas/signals","./User":"tachikomas/User","./channelFollowsFetcher":"tachikomas/channelFollowsFetcher","./userFollowsFetcher":"tachikomas/userFollowsFetcher","./userIDFetcher":"tachikomas/userIDFetcher"}],"tachikomas/utils":[function(t,e,s){(function(s){(function(){const moment="undefined"!=typeof window?window.moment:void 0!==s?s.moment:null,a=t("./constants"),i=t("../models/events");e.exports={muteSeconds:t=>t.set({second:0,millisecond:0}),getTimeBucket(t,e){if(e==a.BUCKET_DAY){const e=moment.unix(t);return e.set({hour:0,minute:0,second:0,millisecond:0}),e.unix()}return t-t%e},extractTabObj(t){if(0===t.length)return{tab:a.TABS_OPTIONS[0],args:{}};const e=t.indexOf("?")>-1?t.indexOf("?"):t.length,s=t.substr(1,e-1).toLowerCase(),i=a.TABS_OPTIONS.indexOf(s)>-1?s:a.TABS_OPTIONS[0],n=new URLSearchParams(t.substr(s.length+1));return{tab:i,args:Object.fromEntries(n.entries())}},getNow:()=>moment().set({second:0,millisecond:0}),getMessageType(t){switch(!0){case t instanceof i.AnonGift:return a.TYPE_ANONGIFT;case t instanceof i.Ban:return a.TYPE_BAN;case t instanceof i.Cheer:return a.TYPE_CHEER;case t instanceof i.Chat:return a.TYPE_CHAT;case t instanceof i.MysterySubGift:return a.TYPE_SUBMYSTERY;case t instanceof i.ReSub:return a.TYPE_RESUB;case t instanceof i.SubGift:return a.TYPE_SUBGIFT;case t instanceof i.Sub:return a.TYPE_SUB;default:throw"invalid object type: "+t}},getRaw(t,e){switch(parseInt(t)){case a.TYPE_ANONGIFT:return new i.AnonGift(e);case a.TYPE_BAN:return new i.Ban(e);case a.TYPE_CHEER:return new i.Cheer(e);case a.TYPE_CHAT:return new i.Chat(e);case a.TYPE_SUBMYSTERY:return new i.MysterySubGift(e);case a.TYPE_RESUB:return new i.ReSub(e);case a.TYPE_SUBGIFT:return new i.SubGift(e);case a.TYPE_SUB:return new i.Sub(e);default:throw"invalid message type: "+t}}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../models/events":"tachikomas/events","./constants":"tachikomas/constants"}]},{},["tachikomas/env","tachikomas/Filter","tachikomas/chartFilter","tachikomas/chattersTableVC","tachikomas/ChartRoot","tachikomas/chatsByUsersVC","tachikomas/Chatters","tachikomas/DateTime","tachikomas/followedStreamersVC","tachikomas/proceedsByTypesVC","tachikomas/proceedsByUsersVC","tachikomas/timeseriesVC","tachikomas/dateTimeRangeVC","tachikomas/stream","tachikomas/navOptionVC","tachikomas/twitchEmbededVC","tachikomas/constants","tachikomas/signals","tachikomas/utils","tachikomas/main","tachikomas/AnonGift","tachikomas/Ban","tachikomas/Chat","tachikomas/Cheer","tachikomas/Common","tachikomas/events","tachikomas/MysterySubGift","tachikomas/ReSub","tachikomas/Sub","tachikomas/SubGift","tachikomas/api","tachikomas/auth","tachikomas/dataCache","tachikomas/blanks","tachikomas/DataBucket","tachikomas/DataChannel","tachikomas/DataNode","tachikomas/twitchAPI","tachikomas/twitchClient","tachikomas/channelFollowsFetcher","tachikomas/users","tachikomas/User","tachikomas/userFollowsFetcher","tachikomas/userIDFetcher"]);